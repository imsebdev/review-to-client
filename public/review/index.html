<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Client Review - SpiderAds</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    function qp(key, fallback="") {
      const url = new URL(window.location.href);
      return url.searchParams.get(key) || fallback;
    }
    
    document.addEventListener("DOMContentLoaded", () => {
      const taskId = qp("taskId");
      const title = qp("title", "Untitled Task");
      const client = qp("client", "Client");
      const due = qp("due", "");
      const previewParam = qp("preview", "");
      
      // Split preview URLs by comma
      const previewUrls = previewParam ? previewParam.split(',').map(url => url.trim()).filter(url => url) : [];
      
      document.getElementById("taskIdText").textContent = taskId || "â€”";
      document.getElementById("titleText").textContent = title;
      document.getElementById("clientText").textContent = client;
      document.getElementById("dueText").textContent = due || "â€”";
      
      // Build carousel or single image
      const carouselMain = document.getElementById("carouselMain");
      const thumbnails = document.getElementById("thumbnails");
      const carouselCounter = document.getElementById("carouselCounter");
      
      if (previewUrls.length === 0) {
        carouselMain.innerHTML = "<em style='color: #9ca3af;'>No preview provided.</em>";
        carouselCounter.style.display = "none";
      } else if (previewUrls.length === 1) {
        // Single image - no carousel needed
        carouselMain.innerHTML = `<img src="${previewUrls[0]}" alt="Preview" style="width:100%; border-radius:12px;">`;
        carouselCounter.style.display = "none";
        document.querySelector('.carousel-nav.prev').style.display = "none";
        document.querySelector('.carousel-nav.next').style.display = "none";
      } else {
        // Multiple images - build carousel
        document.getElementById("totalSlides").textContent = previewUrls.length;
        
        previewUrls.forEach((url, index) => {
          // Create slide
          const slide = document.createElement('div');
          slide.className = 'carousel-slide' + (index === 0 ? ' active' : '');
          slide.innerHTML = `<img src="${url}" alt="Design ${index + 1}">`;
          carouselMain.insertBefore(slide, carouselMain.querySelector('.carousel-nav.prev'));
          
          // Create thumbnail
          const thumb = document.createElement('div');
          thumb.className = 'thumbnail' + (index === 0 ? ' active' : '');
          thumb.onclick = () => goToSlide(index);
          thumb.innerHTML = `<img src="${url}" alt="Thumb ${index + 1}">`;
          thumbnails.appendChild(thumb);
        });
        
        window.slides = document.querySelectorAll('.carousel-slide');
        window.thumbnails = document.querySelectorAll('.thumbnail');
      }
      
      // Fill hidden form fields
      document.getElementById("taskId").value = taskId;
      document.getElementById("title").value = title;
      document.getElementById("client").value = client;
      document.getElementById("due").value = due;
      document.getElementById("preview").value = previewParam;
      
      // Form validation and submission
      const form = document.getElementById("reviewForm");
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        
        const approve = document.getElementById("approve").checked;
        const changes = document.getElementById("changes").checked;
        
        if (!approve && !changes) {
          alert("Please select a decision (Approve or Needs changes).");
          return;
        }
        
        if (changes) {
          const notes = document.getElementById("notes").value.trim();
          if (!notes) {
            alert("Please add notes when requesting changes.");
            return;
        }
        }
        
        // Create hidden iframe for form submission (avoids CORS and new tab)
        const iframe = document.createElement('iframe');
        iframe.name = 'hidden_iframe';
        iframe.style.display = 'none';
        document.body.appendChild(iframe);
        
        // Create temp form for submission
        const tempForm = document.createElement('form');
        tempForm.method = 'POST';
        tempForm.action = 'https://hooks.zapier.com/hooks/catch/24121388/uivwvnj/';
        tempForm.target = 'hidden_iframe'; // Submit to hidden iframe
        
        const formData = new FormData(form);
        for (let [key, value] of formData.entries()) {
          const input = document.createElement('input');
          input.type = 'hidden';
          input.name = key;
          input.value = value;
          tempForm.appendChild(input);
        }
        
        document.body.appendChild(tempForm);
        tempForm.submit();
        
        // Show success immediately
        setTimeout(() => {
          document.body.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%); color: #fff; font-family: 'Inter', sans-serif;">
              <div style="text-align: center; max-width: 500px; padding: 40px;">
                <div style="font-size: 64px; margin-bottom: 24px;">âœ…</div>
                <h2 style="font-size: 32px; margin-bottom: 16px; font-weight: 700;">Review Submitted!</h2>
                <p style="color: #9090b0; font-size: 18px; line-height: 1.6;">Your feedback has been sent to the team. You can close this page now.</p>
              </div>
            </div>
          `;
        }, 500);
      });
    });
    
    // Carousel functions
    let currentSlideIndex = 0;
    
    function showSlide(index) {
      if (!window.slides) return;
      
      window.slides.forEach(s => s.classList.remove('active'));
      window.thumbnails.forEach(t => t.classList.remove('active'));
      
      window.slides[index].classList.add('active');
      window.thumbnails[index].classList.add('active');
      
      document.getElementById('currentSlide').textContent = index + 1;
    }
    
    function changeSlide(direction) {
      if (!window.slides) return;
      
      currentSlideIndex += direction;
      
      if (currentSlideIndex < 0) {
        currentSlideIndex = window.slides.length - 1;
      } else if (currentSlideIndex >= window.slides.length) {
        currentSlideIndex = 0;
      }
      
      showSlide(currentSlideIndex);
    }
    
    function goToSlide(index) {
      currentSlideIndex = index;
      showSlide(currentSlideIndex);
    }
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') changeSlide(-1);
      if (e.key === 'ArrowRight') changeSlide(1);
    });
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: #ffffff;
      padding: 40px 20px;
      line-height: 1.6;
      min-height: 100vh;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
    }
    .card {
      background: rgba(26, 26, 46, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      padding: 48px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }
    h1 {
      font-size: 36px;
      font-weight: 700;
      background: linear-gradient(135deg, #ffffff 0%, #a0a0ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .task-pill {
      background: rgba(160, 160, 255, 0.1);
      border: 1px solid rgba(160, 160, 255, 0.3);
      border-radius: 24px;
      padding: 10px 20px;
      font-size: 14px;
      color: #a0a0ff;
      font-weight: 500;
    }
    .task-info {
      margin-bottom: 40px;
      padding-bottom: 32px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .task-info p {
      margin: 8px 0;
      color: #d0d0e0;
      font-size: 16px;
    }
    .task-info strong {
      color: #ffffff;
      font-weight: 600;
    }
    .task-info small {
      color: #9090b0;
    }
    
    .carousel-container {
      position: relative;
      margin: 40px 0;
    }
    .carousel-counter {
      text-align: center;
      color: #9090b0;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 20px;
      letter-spacing: 0.5px;
    }
    .carousel-main {
      position: relative;
      background: rgba(10, 10, 10, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      overflow: hidden;
      min-height: 500px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .carousel-slide {
      display: none;
      width: 100%;
      animation: fadeIn 0.4s ease;
    }
    .carousel-slide.active {
      display: block;
    }
    .carousel-slide img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 12px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }
    .carousel-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(160, 160, 255, 0.15);
      border: 1px solid rgba(160, 160, 255, 0.3);
      border-radius: 50%;
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      z-index: 10;
    }
    .carousel-nav:hover {
      background: rgba(160, 160, 255, 0.25);
      border-color: rgba(160, 160, 255, 0.5);
      transform: translateY(-50%) scale(1.1);
    }
    .carousel-nav.prev {
      left: 20px;
    }
    .carousel-nav.next {
      right: 20px;
    }
    .carousel-nav svg {
      width: 28px;
      height: 28px;
      fill: #a0a0ff;
    }
    
    .thumbnails {
      display: flex;
      gap: 16px;
      margin-top: 20px;
      overflow-x: auto;
      padding: 12px 0;
    }
    .thumbnails::-webkit-scrollbar {
      height: 8px;
    }
    .thumbnails::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }
    .thumbnails::-webkit-scrollbar-thumb {
      background: rgba(160, 160, 255, 0.3);
      border-radius: 4px;
    }
    .thumbnail {
      flex-shrink: 0;
      width: 110px;
      height: 110px;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      opacity: 0.4;
    }
    .thumbnail:hover {
      opacity: 0.7;
      transform: translateY(-2px);
    }
    .thumbnail.active {
      border-color: #a0a0ff;
      opacity: 1;
      box-shadow: 0 4px 20px rgba(160, 160, 255, 0.3);
    }
    .thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .decision-section {
      margin: 40px 0 32px 0;
    }
    .decision-section h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #ffffff;
    }
    .radio-option {
      display: flex;
      align-items: center;
      padding: 16px 20px;
      margin: 12px 0;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      transition: all 0.3s ease;
    }
    .radio-option:hover {
      background: rgba(160, 160, 255, 0.08);
      border-color: rgba(160, 160, 255, 0.3);
    }
    .radio-option input[type="radio"] {
      width: 22px;
      height: 22px;
      margin-right: 16px;
      cursor: pointer;
      accent-color: #a0a0ff;
    }
    .radio-option label {
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      user-select: none;
      color: #e0e0f0;
    }
    .notes-section {
      margin: 32px 0;
    }
    .notes-section label {
      display: block;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #ffffff;
    }
    textarea {
      width: 100%;
      background: rgba(10, 10, 10, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 16px;
      color: #ffffff;
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      resize: vertical;
      min-height: 140px;
      transition: all 0.3s ease;
    }
    textarea::placeholder {
      color: #7070a0;
    }
    textarea:focus {
      outline: none;
      border-color: rgba(160, 160, 255, 0.5);
      background: rgba(10, 10, 10, 0.8);
      box-shadow: 0 0 0 3px rgba(160, 160, 255, 0.1);
    }
    .actions {
      display: flex;
      gap: 16px;
      margin: 32px 0;
    }
    button {
      padding: 14px 32px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
    }
    .btn-primary {
      background: linear-gradient(135deg, #6060ff 0%, #a0a0ff 100%);
      color: white;
      border: none;
      box-shadow: 0 4px 20px rgba(96, 96, 255, 0.3);
    }
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(96, 96, 255, 0.4);
    }
    .btn-primary:active {
      transform: translateY(0);
    }
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn-secondary {
      background: transparent;
      color: #9090b0;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .btn-secondary:hover {
      border-color: rgba(255, 255, 255, 0.4);
      color: #d0d0e0;
      background: rgba(255, 255, 255, 0.05);
    }
    .footer-text {
      color: #7070a0;
      font-size: 14px;
      margin-top: 24px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <h1>Client Review</h1>
        <div class="task-pill">Task: <span id="taskIdText">â€”</span></div>
      </div>

      <div class="task-info">
        <p><strong id="titleText">Untitled Task</strong> â€” for <strong id="clientText">Client</strong></p>
        <p><small>Due: <span id="dueText">â€”</span></small></p>
      </div>

      <div class="carousel-container">
        <div class="carousel-counter" id="carouselCounter">
          FILE <span id="currentSlide">1</span> OF <span id="totalSlides">1</span>
        </div>
        
        <div class="carousel-main" id="carouselMain">
          <div class="carousel-nav prev" onclick="changeSlide(-1)">
            <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
          </div>
          <div class="carousel-nav next" onclick="changeSlide(1)">
            <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
          </div>
        </div>
        
        <div class="thumbnails" id="thumbnails"></div>
      </div>

      <form id="reviewForm">
        <div class="decision-section">
          <h3>Decision</h3>
          <div class="radio-option">
            <input type="radio" name="decision" id="approve" value="approve">
            <label for="approve">Approve âœ…</label>
          </div>
          <div class="radio-option">
            <input type="radio" name="decision" id="changes" value="needs_changes">
            <label for="changes">Needs changes ðŸ”„</label>
          </div>
        </div>

        <div class="notes-section">
          <label for="notes">Notes</label>
          <textarea id="notes" name="notes" placeholder="Share your feedback here..."></textarea>
        </div>

        <input type="hidden" id="taskId" name="taskId" value="">
        <input type="hidden" id="title" name="title" value="">
        <input type="hidden" id="client" name="client" value="">
        <input type="hidden" id="due" name="due" value="">
        <input type="hidden" id="preview" name="preview" value="">

        <div class="actions">
          <button type="submit" class="btn-primary">Send review</button>
          <button type="reset" class="btn-secondary" onclick="window.location.reload()">Reset</button>
        </div>

        <p class="footer-text">Review all designs using the arrows or thumbnails before submitting your feedback.</p>
      </form>
    </div>
  </div>
</body>
</html>
